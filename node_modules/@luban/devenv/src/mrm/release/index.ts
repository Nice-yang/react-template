import {json, packageJson, install} from "mrm-core";
import MrmTask from "../../types/MrmTask";

const task: MrmTask = function release() {
    const pkgJson = packageJson();

    // 添加release 命令
    pkgJson
        .appendScript("release", "yarn semantic-release --ci false")
        .save();

    const releaseConfig = json(".releaserc", {
        plugins: [
            "@semantic-release/commit-analyzer",
            ["@semantic-release/release-notes-generator"],
            "@semantic-release/changelog",
            [
                "@semantic-release/npm",
                {
                    npmPublish: false
                }
            ],
            [
                "@semantic-release/git",
                {
                    assets: [
                        "package.json",
                        "CHANGELOG.md"
                    ],
                    message: "chore(release): ${nextRelease.version} [skip ci]\n\n${nextRelease.notes}" // eslint-disable-line no-template-curly-in-string
                }
            ]
        ]
    });
    releaseConfig.save();

    install(["@semantic-release/changelog", "@semantic-release/git", "semantic-release"], {yarn: true});
};
task.description = "Add semantic-release config for Luban developer";
export = task;
