import {install, json, lines} from "mrm-core";
import MrmTask from "../../types/MrmTask";

const configGitIgnore = function configGitIgnore() {
    const remove = ["node_modules", "yarn.lock"];
    const add = [
        // OS
        ".DS_Store",
        "Thumbs.db",
        // Common files
        "node_modules/",
        "dist/",
        // vscode
        "/.vscode/settings.json",
        "/.vscode/tasks.json",
        // yarn&npm
        "yarn-error.log",
        "/*.tgz",
        "package-lock.json",
        ".npmrc",
        ".yarnrc",
        // typescript
        "tsconfig.tsbuildinfo",
        // parcel
        ".cache/",
    ];
    lines(".gitignore").remove(remove).add(add).save();
};

const lintCommitMsg = function lintCommitMsg() {
    json(".commitlintrc.json")
        .set("extends", ["@commitlint/config-conventional"])
        .save();

    json(".huskyrc.json")
        .set("hooks.commit-msg", "commitlint -E HUSKY_GIT_PARAMS")
        .save();

    install(["husky", "@commitlint/cli", "@commitlint/config-conventional"], {yarn: true});
};

const task: MrmTask = function git() {
    lintCommitMsg();
    configGitIgnore();
};
task.description = "Setup git for Luban developer";
export = task;
